StmtText,StmtId,NodeId,Parent,PhysicalOp,LogicalOp,Argument,DefinedValues,EstimateRows,EstimateIO,EstimateCPU,AvgRowSize,TotalSubtreeCost,OutputList,Warnings,Type,Parallel,EstimateExecutions
"with t as (
    select
        datepart(year, date) as year,
        productid,
        productname,
        unitprice,
        date,
        row_number() over (partition by datepart(year, date), productid order by unitprice desc) as ranking
    from producthistory
)

select * from t
where ranking < 5
order by year, productid, ranking",1,1,0,,,1,,693000,,,,55.131897,,,SELECT,false,
"  |--Parallelism(Gather Streams, ORDER BY:([Expr1004] ASC, [northwind].[dbo].[producthistory].[productid] ASC, [Expr1003] ASC))",1,2,1,Parallelism,Gather Streams,"ORDER BY:([Expr1004] ASC, [northwind].[dbo].[producthistory].[productid] ASC, [Expr1003] ASC)",,693000,0,4.810287,59,55.131897,"[northwind].[dbo].[producthistory].[productid], [northwind].[dbo].[producthistory].[productname], [northwind].[dbo].[producthistory].[unitprice], [northwind].[dbo].[producthistory].[date], [Expr1003], [Expr1004]",,PLAN_ROW,true,1
"       |--Sort(ORDER BY:([Expr1004] ASC, [northwind].[dbo].[producthistory].[productid] ASC, [Expr1003] ASC))",1,3,2,Sort,Sort,"ORDER BY:([Expr1004] ASC, [northwind].[dbo].[producthistory].[productid] ASC, [Expr1003] ASC)",,693000,6.9191065,0.5654385,59,50.32057,"[northwind].[dbo].[producthistory].[productid], [northwind].[dbo].[producthistory].[productname], [northwind].[dbo].[producthistory].[unitprice], [northwind].[dbo].[producthistory].[date], [Expr1003], [Expr1004]",,PLAN_ROW,true,1
            |--Filter(WHERE:([Expr1003]<(5))),1,4,3,Filter,Filter,WHERE:([Expr1003]<(5)),,693000,0,0.2772,59,42.836025,"[northwind].[dbo].[producthistory].[productid], [northwind].[dbo].[producthistory].[productname], [northwind].[dbo].[producthistory].[unitprice], [northwind].[dbo].[producthistory].[date], [Expr1003], [Expr1004]",,PLAN_ROW,true,1
"                 |--Compute Scalar(DEFINE:([Expr1004]=datepart(year,[northwind].[dbo].[producthistory].[date])))",1,5,4,Compute Scalar,Compute Scalar,"DEFINE:([Expr1004]=datepart(year,[northwind].[dbo].[producthistory].[date]))","[Expr1004]=datepart(year,[northwind].[dbo].[producthistory].[date])",2310000,0,0.005775,59,42.558826,"[northwind].[dbo].[producthistory].[productid], [northwind].[dbo].[producthistory].[productname], [northwind].[dbo].[producthistory].[unitprice], [northwind].[dbo].[producthistory].[date], [Expr1003], [Expr1004]",,PLAN_ROW,true,1
"                      |--Window Aggregate(DEFINE:([Expr1003]=row_number), PARTITION COLUMNS:([Expr1002], [northwind].[dbo].[producthistory].[productid]), ROWS BETWEEN:(UNBOUNDED, CURRENT ROW))",1,6,5,Window Aggregate,Window Aggregate,"DEFINE:([Expr1003]=row_number), PARTITION COLUMNS:([Expr1002], [northwind].[dbo].[producthistory].[productid]), ROWS BETWEEN:(UNBOUNDED, CURRENT ROW)",[Expr1003]=row_number,2310000,0,0.005775,55,42.55305,"[northwind].[dbo].[producthistory].[productid], [northwind].[dbo].[producthistory].[productname], [northwind].[dbo].[producthistory].[unitprice], [northwind].[dbo].[producthistory].[date], [Expr1003]",,PLAN_ROW,true,1
"                           |--Sort(ORDER BY:([Expr1002] ASC, [northwind].[dbo].[producthistory].[productid] ASC, [northwind].[dbo].[producthistory].[unitprice] DESC))",1,7,6,Sort,Sort,"ORDER BY:([Expr1002] ASC, [northwind].[dbo].[producthistory].[productid] ASC, [northwind].[dbo].[producthistory].[unitprice] DESC)",,2310000,20.844595,2.3451586,51,42.547276,"[northwind].[dbo].[producthistory].[productid], [northwind].[dbo].[producthistory].[productname], [northwind].[dbo].[producthistory].[unitprice], [northwind].[dbo].[producthistory].[date], [Expr1002]",,PLAN_ROW,true,1
"                                |--Compute Scalar(DEFINE:([Expr1002]=datepart(year,[northwind].[dbo].[producthistory].[date])))",1,8,7,Compute Scalar,Compute Scalar,"DEFINE:([Expr1002]=datepart(year,[northwind].[dbo].[producthistory].[date]))","[Expr1002]=datepart(year,[northwind].[dbo].[producthistory].[date])",2310000,0,0.005775,51,19.357523,"[northwind].[dbo].[producthistory].[productid], [northwind].[dbo].[producthistory].[productname], [northwind].[dbo].[producthistory].[unitprice], [northwind].[dbo].[producthistory].[date], [Expr1002]",,PLAN_ROW,true,1
                                     |--Clustered Index Scan(OBJECT:([northwind].[dbo].[producthistory].[pk_product_history])),1,9,8,Clustered Index Scan,Clustered Index Scan,OBJECT:([northwind].[dbo].[producthistory].[pk_product_history]),"[northwind].[dbo].[producthistory].[productid], [northwind].[dbo].[producthistory].[productname], [northwind].[dbo].[producthistory].[unitprice], [northwind].[dbo].[producthistory].[date]",2310000,18.71646,0.63528925,47,19.351748,"[northwind].[dbo].[producthistory].[productid], [northwind].[dbo].[producthistory].[productname], [northwind].[dbo].[producthistory].[unitprice], [northwind].[dbo].[producthistory].[date]",,PLAN_ROW,true,1
